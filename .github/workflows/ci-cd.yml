name: CalTrack CI/CD Pipeline

on:
  push:
    branches: ["main"]
  workflow_dispatch:

permissions:
  contents: write

jobs:
  build-and-release:
    runs-on: ubuntu-latest

    steps:
      # 1. Клонування репозиторію
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2. Виведення інформації про виконавця
      - name: Display Author Info
        run: |
          echo "========================================="
          echo "  CI/CD Pipeline for CalTrack"
          echo "  Student: Іваха Богдан (Group КВ-32)"
          echo "  Date: $(date)"
          echo "========================================="

      # 3. Імітація процесу збірки — архівація проекту
      - name: Package Project
        run: |
          echo "Creating project archive..."
          mkdir -p build
          zip -r build/CalTrack_Project.zip *.py Assets
          echo "Project archive created successfully!"

      # 4. Генерація унікального тегу для релізу
      - name: Generate Release Version
        id: release
        run: echo "release_tag=v1.0.$(date +%s)" >> $GITHUB_OUTPUT

      # 5. Публікація релізу на GitHub
      - name: Publish Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: ${{ steps.release.outputs.release_tag }}
          name: "CalTrack Release ${{ steps.release.outputs.release_tag }}"
          body: |
            Автоматично створений реліз для лабораторної роботи.
            Виконавець: Іваха Богдан, КВ-32.
          files: build/CalTrack_Project.zip
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
