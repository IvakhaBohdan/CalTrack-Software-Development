name: CI/CD Pipeline for CalTrack

# Тригер: запускати при будь-якому push у гілку main
on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

# Дозвіл на запис 
permissions:
  contents: write

jobs:
  build-and-release:
    runs-on: ubuntu-latest

    steps:
      # 1. Завантажуємо файли з репозиторію
      - name: Checkout code
        uses: actions/checkout@v4

      # 2. Вивід інформації про автора (Вимога завдання)
      - name: Print Author Info (Ivakha Bohdan, KV-32)
        run: |
          echo "Лабораторна робота: Іваха Богдан, КВ-32"
          echo "Збірку ініційовано користувачем GitHub: ${{ github.actor }}"
          echo "Повідомлення коміту: ${{ github.event.head_commit.message }}"

      # 3. Автоматичне збирання додатку
      - name: Build Application (Archiving src folder)
        run: |
          echo "Початок процесу збірки..."
          if [ -d "src" ]; then
            # Створюємо ZIP-архів з вмістом папки src
            zip -r CalTrack-Build.zip src/
            echo "Збірка успішна. Артефакт CalTrack-Build.zip створено."
          else
            echo "Помилка: Папка 'src' не знайдена. Збірку неможливо виконати."
            exit 1
          fi

      # 4. Публікація реліза в репозиторії GitHub
      # Використовуємо номер поточного запуску для унікального тегу версії
      - name: Create GitHub Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: v1.0.${{ github.run_number }}
          name: Auto Release v1.0.${{ github.run_number }}
          body: |
            ## Автоматичний реліз CalTrack
            
            Ця версія зібрана та опублікована системою GitHub Actions.
            
            **Автор змін:** ${{ github.actor }}
            **Збірка №:** ${{ github.run_number }}
          files: CalTrack-Build.zip
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
